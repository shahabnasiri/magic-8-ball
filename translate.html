<!doctype html>
<html lang="fa">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ترجمه فارسی → انگلیسی (با Google Translate)</title>
  <style>
    :root{font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto, "Helvetica Neue",Arial;}
    body{direction:rtl;padding:24px;background:#f5f7fb;color:#111}
    .card{background:#fff;border-radius:12px;box-shadow:0 6px 18px rgba(20,30,50,0.08);padding:18px;max-width:760px;margin:20px auto}
    label{display:block;margin-bottom:6px;font-weight:600}
    textarea{width:100%;min-height:120px;padding:10px;border-radius:8px;border:1px solid #e3e8ef;resize:vertical;font-size:15px}
    .controls{display:flex;gap:8px;align-items:center;margin-top:10px}
    button{background:#0b69ff;color:#fff;border:none;padding:10px 14px;border-radius:8px;font-weight:700;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    .output{margin-top:14px}
    .hint{margin-top:10px;color:#556;font-size:13px}
    .small{font-size:13px;color:#666}
  </style>
</head>
<body>
  <div class="card">
    <h2>ترجمه فارسی → انگلیسی (Google Translate)</h2>

    <label for="input">متن فارسی:</label>
    <textarea id="input" placeholder="اینجا متن فارسی را وارد کنید..."></textarea>

    <div class="controls">
      <button id="translateBtn">ترجمه</button>
      <div id="status" class="small">آماده</div>
    </div>

    <div class="output">
      <label for="output">ترجمه انگلیسی:</label>
      <textarea id="output" readonly placeholder="نتیجه ترجمه اینجا نمایش داده می‌شود..."></textarea>
    </div>

    <p class="hint">توجه: این نمونه از یک رابط غیررسمی (بدون کلید API) استفاده می‌کند که ممکن است محدودیت یا مشکل CORS داشته باشد. اگر با خطا مواجه شدید، راهنمایی زیر را در انتها ببینید.</p>

    <details>
      <summary style="cursor:pointer">راهنمای جایگزین (استفاده از Google Cloud Translation با API key)</summary>
      <div style="margin-top:8px">
        <p class="small">اگر پروژهٔ Google Cloud و API key دارید، بهتر است از Google Cloud Translation استفاده کنید. در این حالت باید درخواست را به سرور خود یا مستقیم به endpoint رسمی ارسال کنید و <strong>کلید API</strong> را در سرور نگه دارید (قرار دادن کلید در کد سمت کاربر ناامن است).</p>
        <p class="small">برای اطلاعات بیشتر به مستندات Google Cloud Translation مراجعه کنید.</p>
      </div>
    </details>
  </div>

  <script>
    const inputEl = document.getElementById('input');
    const outputEl = document.getElementById('output');
    const btn = document.getElementById('translateBtn');
    const statusEl = document.getElementById('status');

    async function translateText(text){
      // روش سریع و رایج: endpoint غیررسمی google translate
      // ممکن است در برخی محیط‌ها (به خاطر CORS) کار نکند. اگر خطای CORS دیدید، از یک سرور میانی یا Google Cloud API استفاده کنید.
      const base = 'https://translate.googleapis.com/translate_a/single?client=gtx';
      const params = new URLSearchParams({
        sl: 'fa', // source language Persian
        tl: 'en', // target language English
        dt: 't',  // return translated text
        q: text
      });

      const url = `${base}&${params.toString()}`;

      const resp = await fetch(url);
      if (!resp.ok) throw new Error('سرور ترجمه پاسخ مناسبی نداد: ' + resp.status);
      const data = await resp.json();
      // ساختار بازگشتی: آرایه‌هایی که جمله به جمله ترجمه را دارند
      // مثال: [[["translated text","original text",null,null, ... ]], ...]
      if (!Array.isArray(data)) throw new Error('فرمت پاسخ نامعلوم است');

      // جمع‌آوری همه قطعات ترجمه
      let translated = '';
      try{
        const parts = data[0];
        for (const seg of parts) {
          if (seg[0]) translated += seg[0];
        }
      } catch(e){
        throw new Error('خواندن پاسخ ترجمه ناموفق بود');
      }
      return translated;
    }

    btn.addEventListener('click', async ()=>{
      const text = inputEl.value.trim();
      outputEl.value = '';
      if (!text){
        statusEl.textContent = 'ورودی خالی است';
        return;
      }
      btn.disabled = true;
      statusEl.textContent = 'در حال ترجمه...';

      try{
        const translated = await translateText(text);
        outputEl.value = translated;
        statusEl.textContent = 'ترجمه انجام شد';
      } catch (err){
        console.error(err);
        statusEl.textContent = 'خطا: ' + (err.message || 'مشکل در ترجمه');
        outputEl.value = '';
      } finally{
        btn.disabled = false;
      }
    });

    // قابلیت ارسال با Ctrl+Enter یا Cmd+Enter
    inputEl.addEventListener('keydown', (e)=>{
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        btn.click();
      }
    });
  </script>
</body>
</html>
